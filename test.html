<!DOCTYPE html>
<meta charset = "utf-8">
<html>
<head>

  <title>Graph exploration</title>

  <!--D3v3, textbox, hierarchy
  <script src="https://d3plus.org/js/d3plus.js"></script>
-->
   <script src="https://d3js.org/d3.v3.js" charset="utf-8"></script>

</head>
<body>

<script >

mobile = window.screen.width<800 //false enleverait l'affichage d'infos
width = mobile?  document.body.clientWidth : window.screen.width, // svg width
height = width*1.5// svg height

let counter=1

const body = d3.select("body");

const canvas = body.append("svg").attr("id", "canvas")
    .style("border", "1px solid #ccc")
    .attr("width", width)
    .attr("height", height)



const zoomCanvas = canvas.append("svg").attr("id", "zoomCanvas")


zoomCanvas.append("rect")//il faut un rectangle qui réagit aux events de zoom
                          //mais le zoom s'applique à tout ce qui est sur vis (et pas au rectangle)
    .attr("width",200)
    .attr("height", 200).attr("opacity", .05);

//html structure:canvas - [ infog, zoomCanvas [ vis [ nodeg, linkg, hullg ]]]
const vis = zoomCanvas.attr("id", "vis").append("circle").attr("r", 30)
.attr("cx", 100)
.attr("cy", 100)
.attr("fill","red")
; //nodeuds

const zoom = d3.behavior.zoom()
    .scaleExtent([.1, 10])
    .scale(1)
    .on("zoom", zoomed);


zoomCanvas.on("mouseover", function() {
  counter++

        d3.select(this).style("cursor", "all-scroll")
    })
    .call(zoom) // delete this line to disable free zooming
    .call(zoom.event);


    function zoomed() {
      //window.alert('zoom')
      counter++
      let x=d3.event.translate[0]
      let y=d3.event.translate[1]
        /*prevTgt=msTgt;
        msTgt="root"//d3.event.sourceEvent.target.id||"root";
        if (msTgt==="canv" && prevTgt==="canv") {*/
        vis.attr("transform", "translate(" +( x)+","+(y) + ")scale(" + (d3.event.scale) + ")")
        //infoG.attr("transform", "translate(0,"+d3.event.translate[0]+")")

        canvas.append("g")
                .attr("id", "infog").attr("display", "block").append("text")
                    .attr("x", 200)
                    .style("font-family", "American Typewriter, serif")
                    .attr("y", 200)//d => d.lastName ? d.imgDisp ?  "2em" : "-1.2em" : d.imgDisp ? "3em" : 0)//d.radius  : -0.6*d.radius : d.imgDisp ? 1.5*d.radius:0)//
                    .text(counter)
    }
let infoG = canvas.append("g")
        .attr("id", "infog").attr("display", "block").append("text")
            .attr("x", 200)
            .style("font-family", "American Typewriter, serif")
            .attr("y", 200)//d => d.lastName ? d.imgDisp ?  "2em" : "-1.2em" : d.imgDisp ? "3em" : 0)//d.radius  : -0.6*d.radius : d.imgDisp ? 1.5*d.radius:0)//
            .text(counter)

</script>

</script>
</body>
</html>
